spring:
  # No definir profile activo por defecto → producción segura
  # Para desarrollo: --spring.profiles.active=local (ver launch.json o iniciar-api.ps1)
  application:
    name: appgestion-api

  # Mail (SMTP) - configurar MAIL_USERNAME y MAIL_PASSWORD para envío de PDFs
  # Gmail: usar contraseña de aplicación si tienes 2FA
  mail:
    host: ${MAIL_HOST:smtp.gmail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

  datasource:
    url: jdbc:postgresql://localhost:5433/appgestion
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        '[format_sql]': true
        '[default_schema]': public
    open-in-view: false

server:
  port: 8081
  servlet:
    context-path: /api

# Stripe
stripe:
  secret-key: ${STRIPE_SECRET_KEY:sk_test_xxx}
  webhook-secret: ${STRIPE_WEBHOOK_SECRET:whsec_xxx}
  price-id-monthly: ${STRIPE_PRICE_MONTHLY:price_xxx}
  success-url: ${STRIPE_SUCCESS_URL:http://localhost:4200/subscription/success}
  cancel-url: ${STRIPE_CANCEL_URL:http://localhost:4200/subscription/cancel}
  portal-return-url: ${STRIPE_PORTAL_RETURN_URL:http://localhost:4200/dashboard}

# App config: skip-check true por defecto para desarrollo (sin Stripe)
# PRODUCCIÓN: definir SPRING_PROFILES_ACTIVE=prod para exigir suscripción
app:
  subscription:
    skip-check: true
  jwt:
    secret: ${JWT_SECRET:tu-clave-secreta-muy-larga-minimo-256-bits-para-HS256}
    expiration-ms: 86400000   # 24 horas
    issuer: appgestion-api

# Logging
logging:
  level:
    '[com.appgestion]': DEBUG
    '[org.springframework.web]': INFO
    '[org.hibernate.SQL]': DEBUG

---
# Perfil local: desarrollo sin Stripe (omitir comprobación de suscripción)
spring:
  config:
    activate:
      on-profile: local
app:
  subscription:
    skip-check: true

---
# Perfil prod: exigir suscripción activa (para despliegue)
spring:
  config:
    activate:
      on-profile: prod
app:
  subscription:
    skip-check: false
